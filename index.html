<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Stripe Payment & Subscription</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 min-h-screen flex items-center justify-center">
  <div class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-lg">
    <h1 class="text-3xl font-bold text-center text-gray-800 mb-6">üí≥ Payment Portal</h1>

    <div class="space-y-5">
      <!-- Payment Type -->
      <div>
        <label class="block text-sm font-medium text-gray-600 mb-1">Payment Mode</label>
        <select id="paymentMode"
          class="w-full border-gray-300 rounded-lg p-2 focus:ring-2 focus:ring-blue-500">
          <option value="one-time">One-Time Payment</option>
          <option value="subscription">Subscription</option>
        </select>
      </div>

      <!-- Amount -->
      <div>
        <label class="block text-sm font-medium text-gray-600 mb-1">Amount (in cents)</label>
        <input id="amount" type="number" placeholder="e.g. 1500 for $15.00"
          class="w-full border-gray-300 rounded-lg p-2 focus:ring-2 focus:ring-blue-500">
      </div>

      <!-- Currency -->
      <div>
        <label class="block text-sm font-medium text-gray-600 mb-1">Currency</label>
        <select id="currency" class="w-full border-gray-300 rounded-lg p-2 focus:ring-2 focus:ring-blue-500">
          <option value="usd">USD</option>
          <option value="eur">EUR</option>
          <option value="gbp">GBP</option>
        </select>
      </div>

      <!-- Interval (for subscriptions) -->
      <div id="intervalContainer" class="hidden">
        <label class="block text-sm font-medium text-gray-600 mb-1">Billing Interval</label>
        <select id="interval" class="w-full border-gray-300 rounded-lg p-2 focus:ring-2 focus:ring-blue-500">
          <option value="month">Monthly</option>
          <option value="year">Yearly</option>
          <option value="week">Weekly</option>
        </select>
      </div>

      <!-- Payment Method Type -->
      <div>
        <label class="block text-sm font-medium text-gray-600 mb-1">Payment Method</label>
        <select id="paymentMethodType" class="w-full border-gray-300 rounded-lg p-2 focus:ring-2 focus:ring-blue-500">
          <option value="card">Credit / Debit Card</option>
          <option value="us_bank_account">Bank (ACH)</option>
        </select>
      </div>

      <!-- Reference -->
      <div>
        <label class="block text-sm font-medium text-gray-600 mb-1">Reference</label>
        <input id="ref" type="text" placeholder="Optional reference or order ID"
          class="w-full border-gray-300 rounded-lg p-2 focus:ring-2 focus:ring-blue-500">
      </div>

      <!-- Email -->
      <div>
        <label class="block text-sm font-medium text-gray-600 mb-1">Email (optional)</label>
        <input id="email" type="email" placeholder="customer@example.com"
          class="w-full border-gray-300 rounded-lg p-2 focus:ring-2 focus:ring-blue-500">
      </div>

      <!-- Submit -->
      <button id="submitBtn"
        class="w-full bg-blue-600 hover:bg-blue-700 text-white rounded-lg p-3 font-semibold">
        Process Payment
      </button>

      <div id="result" class="text-center text-gray-700 mt-4 text-sm"></div>
    </div>
  </div>

  <script>
    const modeSelect = document.getElementById("paymentMode");
    const intervalContainer = document.getElementById("intervalContainer");
    const result = document.getElementById("result");

    // Toggle interval visibility based on payment type
    modeSelect.addEventListener("change", () => {
      intervalContainer.classList.toggle("hidden", modeSelect.value !== "subscription");
    });

    // Handle submission
    document.getElementById("submitBtn").addEventListener("click", async () => {
      result.innerHTML = "Processing... ‚è≥";

      const mode = modeSelect.value;
      const amount = parseInt(document.getElementById("amount").value, 10);
      const currency = document.getElementById("currency").value;
      const ref = document.getElementById("ref").value.trim();
      const email = document.getElementById("email").value.trim();
      const paymentMethodType = document.getElementById("paymentMethodType").value;
      const interval = document.getElementById("interval").value;

      if (!amount || amount <= 0) {
        result.innerHTML = '<span class="text-red-600">‚ùå Please enter a valid amount.</span>';
        return;
      }

      try {
        const endpoint = mode === "subscription" ? "/create-subscription" : "/create-payment-intent";

        const body = mode === "subscription"
          ? { amount, currency, email, ref, paymentMethodType, interval }
          : { amount, currency, email, ref };

        const res = await fetch(endpoint, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(body),
        });

        const data = await res.json();

        if (data.error) {
          result.innerHTML = `<span class="text-red-600">‚ùå ${data.error}</span>`;
        } else {
          if (mode === "subscription") {
            result.innerHTML = `
              <p class="text-green-600 font-medium">‚úÖ Subscription created successfully!</p>
              <p>ID: ${data.subscriptionId}</p>
              <p>Status: ${data.status}</p>
              <p>Ref: ${data.ref || '‚Äî'}</p>
            `;
          } else {
            result.innerHTML = `
              <p class="text-green-600 font-medium">‚úÖ Payment Intent created!</p>
              <p>Status: ${data.status}</p>
              <p>Ref: ${data.ref || '‚Äî'}</p>
            `;
          }
        }
      } catch (err) {
        console.error(err);
        result.innerHTML = `<span class="text-red-600">‚ùå ${err.message}</span>`;
      }
    });
  </script>
</body>
</html>
