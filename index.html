<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Subscription Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#2563eb', // Blue 600
            accent: '#1d4ed8', // Blue 700
          }
        }
      }
    }
  </script>
</head>

<body class="bg-gray-100 min-h-screen flex items-center justify-center">
  <div class="bg-white rounded-3xl shadow-2xl p-8 w-full max-w-lg transition-all duration-300">
    <h1 class="text-3xl font-bold mb-6 text-center text-gray-800">
      üí≥ Create a Subscription
    </h1>

    <div class="space-y-5">
      <!-- Email -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Customer Email</label>
        <input id="email" type="email" placeholder="customer@example.com"
          class="w-full border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-primary focus:border-primary outline-none transition"/>
      </div>

      <!-- Payment Method -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Payment Type</label>
        <select id="paymentType"
          class="w-full border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-primary focus:border-primary outline-none transition">
          <option value="card">üí≥ Credit / Debit Card</option>
          <option value="us_bank_account">üè¶ Bank Account (ACH)</option>
        </select>
      </div>

      <!-- Plan Selection -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Select Plan</label>
        <div class="grid grid-cols-2 gap-3">
          <button class="plan-btn border rounded-lg p-3 hover:bg-blue-50 transition" data-price="price_monthly">
            <p class="font-semibold text-gray-800">Monthly</p>
            <p class="text-sm text-gray-500">$10 / month</p>
          </button>
          <button class="plan-btn border rounded-lg p-3 hover:bg-blue-50 transition" data-price="price_yearly">
            <p class="font-semibold text-gray-800">Annual</p>
            <p class="text-sm text-gray-500">$100 / year</p>
          </button>
        </div>
        <input type="hidden" id="priceId" />
      </div>

      <!-- Button -->
      <button id="subscribeBtn"
        class="w-full bg-primary hover:bg-accent text-white rounded-lg p-3 font-semibold flex items-center justify-center gap-2 transition disabled:opacity-50 disabled:cursor-not-allowed">
        <span id="btnText">Create Subscription</span>
        <svg id="loadingIcon" class="hidden animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8z"></path>
        </svg>
      </button>

      <!-- Result / Feedback -->
      <div id="result" class="text-center text-sm mt-4"></div>
    </div>
  </div>

  <script>
    const priceInput = document.getElementById("priceId");
    const planButtons = document.querySelectorAll(".plan-btn");
    const subscribeBtn = document.getElementById("subscribeBtn");
    const result = document.getElementById("result");
    const loadingIcon = document.getElementById("loadingIcon");
    const btnText = document.getElementById("btnText");

    // Handle plan selection
    planButtons.forEach(btn => {
      btn.addEventListener("click", () => {
        planButtons.forEach(b => b.classList.remove("ring-2", "ring-primary", "bg-blue-50"));
        btn.classList.add("ring-2", "ring-primary", "bg-blue-50");
        priceInput.value = btn.dataset.price;
      });
    });

    // Handle subscription creation
    subscribeBtn.addEventListener("click", async () => {
      const email = document.getElementById("email").value.trim();
      const paymentType = document.getElementById("paymentType").value;
      const priceId = priceInput.value;

      result.innerHTML = "";
      if (!email || !priceId) {
        result.innerHTML = `<p class="text-red-600">‚ö†Ô∏è Please enter email and select a plan.</p>`;
        return;
      }

      subscribeBtn.disabled = true;
      loadingIcon.classList.remove("hidden");
      btnText.textContent = "Processing...";

      try {
        const res = await fetch("/create-subscription", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email, priceId, paymentMethodType: paymentType }),
        });

        const data = await res.json();
        if (data.error) {
          result.innerHTML = `<p class="text-red-600">‚ùå ${data.error}</p>`;
        } else {
          result.innerHTML = `
            <p class="text-green-600 font-semibold">‚úÖ Subscription Created!</p>
            <p><b>ID:</b> ${data.subscriptionId}</p>
            <p><b>Status:</b> ${data.status}</p>
          `;
        }
      } catch (err) {
        console.error(err);
        result.innerHTML = `<p class="text-red-600">‚ö†Ô∏è Network or server error.</p>`;
      } finally {
        subscribeBtn.disabled = false;
        loadingIcon.classList.add("hidden");
        btnText.textContent = "Create Subscription";
      }
    });
  </script>
</body>
</html>
